machine:
  timezone:
    Asia/Tokyo
  java:
    version:
      openjdk8

dependencies:
  override:
    - echo ${CIRCLE_BUILD_NUM}
    - mvn -B -f webapp/pom.xml clean package findbugs:findbugs pmd:pmd -Dbuild.number=${CIRCLE_BUILD_NUM} -Pdeploy -Dmaven.test.skip=true

test:
  override:
    - echo "No Test(copy webapp war)"
    - # pwd;find . | sort | sed '1d;s/^\.//;s/\/\([^/]*\)$/|--\1/;s/\/[^/|]*/|  /g'
    - ls -al webapp/appExample01/target
    - cp webapp/appExample01/target/appExample01.war webapp/target/
    - ls -al webapp/appExample02/target
    - cp webapp/appExample02/target/appExample02.war webapp/target/

deployment:
  staging:
    branch: develop/1.0.0
    commands:
      - echo "1.0.0 deployment"
      - git clone https://github.com/public-test-circleci/module-all.git
      - cd module-all && git checkout release/1.0.0
      - cp -f webapp/target/*.war module-all/webapp/
      - cd module-all && git config --global user.email li@exgen.co.jp
      - cd module-all && git config --global user.name li-exgen
      - cd module-all && git commit -am "deploy from CircleCI(CIRCLE_BUILD_NUM:${CIRCLE_BUILD_NUM})"
      - cd module-all && git push origin release/1.0.0

general:
  branches:
    only:
      - develop/1.0.0
